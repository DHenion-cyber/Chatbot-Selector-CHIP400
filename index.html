<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Digital Health Chatbot Portal</title>
  <script src="https://cdn.abacus.ai/chat-widget.js"></script>
  <style>
    body { background: #f4f9fb; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; }
    .container { max-width: 640px; margin: 40px auto; padding: 32px; background: #fff; border-radius: 20px; box-shadow: 0 2px 16px rgba(0,0,0,0.08); }
    h2 { color: #278be6; margin-top: 0; }
    label { font-size: 1rem; margin-right: 10px; }
    select { padding: 8px; font-size: 1rem; margin-bottom: 16px; }
    #chatIntro { margin-top: 24px; min-height: 150px; }
    .bot-message { background: #d6eaff; border-radius: 10px; padding: 10px 16px; margin: 10px 0; font-size: 1.07rem; max-width: 95%; box-shadow: 0 1px 6px rgba(39,139,230,0.04); }
    #chatContainer { margin-top: 28px; border: 1px solid #ccc; border-radius: 10px; height: 500px; display: none; overflow-y: auto; }
    .user-message { background: #e0e0e0; border-radius: 10px; padding: 10px 16px; margin: 10px 0; font-size: 1.07rem; max-width: 95%; text-align: right; }
    #inputRow { display: none; margin-top: 20px; gap: 12px; }
    #inputRow.flex { display: flex; }
    #userInput { flex: 1; padding: 8px; font-size: 1rem; border-radius: 8px; border: 1px solid #b5d5f6; }
    #sendBtn { padding: 8px 20px; border-radius: 8px; border: none; background: #278be6; color: #fff; font-size: 1rem; cursor: pointer; transition: background 0.18s; }
    #sendBtn:active { background: #176ab7; }
    @media (max-width: 480px) {
      .container { padding: 16px; margin: 20px; }
      #chatContainer { height: 400px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Digital Health Chatbot Portal</h2>
    <label for="botDropdown">Choose a Chatbot Agent:</label>
    <select id="botDropdown">
      <option value="">-- Select Agent --</option>
      <option value="startup">Startup Ideation</option>
    </select>

    <div id="chatIntro"></div>
    <div id="chatContainer"></div>

    <div id="inputRow">
      <input id="userInput" type="text" placeholder="Type your answer..." />
      <button id="sendBtn">Send</button>
    </div>
  </div>

  <script>
    const botConfigs = { 
      "startup": {
        name: "Startup Ideation",
        deploymentToken: "f1e2a505ce1641698d89d014ac87b2bf"
      }
    };

    const botDropdown = document.getElementById("botDropdown");
    const chatIntro = document.getElementById("chatIntro");
    const chatContainer = document.getElementById("chatContainer");
    const inputRow = document.getElementById("inputRow");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");

    const scriptedIntro = [
      "Hello! I'm trained to help you explore ideas for digital health innovation! I'd like to start by getting to know a little about your expertise, experience, and interests. What areas of the health landscape interest you most? (i.e., wellness, research, education, nursing, acute care, prosthetics, etc.)",
      "Are there problems that you're particularly interested in addressing?",
      "Many people find themselves naturally oriented towards one of the following areas. Do you?\n- Patient Impact\n- Quality (may not be directly patients)\n- Finance/savings\n- Efficiency\n- New Technology",
      "Do you have subject matter expertise or professional experience you want to share with me? This helps inform me of dynamics that you may be more familiar with to draw on your existing knowledge.",
      "Are there qualities you know you want to design a business strategy around? For example, some people may want to stick to ideas that could be implemented quickly on a small scale with minimum funding while others may be more interested in exploring big ideas with longer timelines and external funding. Describe any potential business qualities that matter to you."
    ];

    let currentIntroIdx = 0;
    let userAnswers = [];

    function resetChat() {
      chatIntro.innerHTML = "";
      chatIntro.style.display = 'block';
      chatContainer.innerHTML = "";
      chatContainer.style.display = 'none';
      inputRow.classList.remove('flex');
      userAnswers = [];
      currentIntroIdx = 0;
    }

    function showBotMessage(text) {
      const div = document.createElement("div"); div.className = "bot-message"; div.innerText = text;
      chatIntro.appendChild(div); chatIntro.scrollTop = chatIntro.scrollHeight;
    }

    function showUserMessage(text) {
      const div = document.createElement("div"); div.className = "user-message"; div.innerText = text;
      chatIntro.appendChild(div); chatIntro.scrollTop = chatIntro.scrollHeight;
    }

    async function startAbacusChatWidget() {
  chatIntro.style.display = 'none';
  chatContainer.style.display = 'block';
  try {
    const payload = {
      user_input_json: JSON.stringify(userAnswers), // Or structure as needed
      keyword_arguments: ""
    };
    await AbacusChatWidget.init({
      deploymentId: 'cf280c6aa',       // e.g., 'cf280c6aa'
      deploymentToken: 'f1e2a505ce1641698d89d014ac87b2bf', // e.g., 'f1e2a505ce1641698d89d014ac87b2bf'
      container: '#chatContainer',
      initialMessages: [
        { role: 'user', content: JSON.stringify(payload) }
      ]
    });
  } catch (e) {
    chatContainer.innerHTML = "<div style='color:red;padding:12px'>⚠️ Error loading chat: " + (e.message || e) + "</div>";
    console.error("AbacusChatWidget error:", e);
      }
    }

    function askNextIntro() {
      if (currentIntroIdx < scriptedIntro.length) {
        showBotMessage(scriptedIntro[currentIntroIdx]);
        inputRow.classList.add('flex');
        userInput.value = "";
        userInput.focus();
      } else {
        inputRow.classList.remove('flex');
        startAbacusChatWidget();
      }
    }

    sendBtn.onclick = () => {
      const answer = userInput.value.trim();
      if (!answer) return;
      showUserMessage(answer);
      userAnswers.push(answer);
      inputRow.classList.remove('flex');
      currentIntroIdx++;
      setTimeout(askNextIntro, 800);
    };

    userInput.onkeydown = e => { if (e.key === "Enter") sendBtn.onclick(); };

    botDropdown.addEventListener("change", () => {
      resetChat();
      if (!botConfigs[botDropdown.value]) return;
      askNextIntro();
    });
  </script>
</body>
</html>
